/* ==========================================================================
   PromptStudioSystem.css
   Central design system for Prompt Studio (tokens + primitives + aliases)

   Style DNA:
   - Framer: motion-first, subtle gradients
   - Raycast: dense, macOS-native, restrained
   - Arc: editorial layout rhythm
   - Superhuman: sharp hierarchy, premium controls
   ========================================================================== */

@layer ps.tokens, ps.aliases, ps.primitives, ps.components, ps.utilities;

/* ------------------------------------------
   TOKENS (source of truth)
   ------------------------------------------ */
@layer ps.tokens {
  :root {
    /* Fonts */
    --font-sans: var(--font-geist-sans, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif);
    --font-mono: var(--font-geist-mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);

    /* Type scale */
    --fs-10: 10px;
    --fs-11: 11px;
    --fs-12: 12px;
    --fs-13: 13px;
    --fs-14: 14px;
    --fs-16: 16px;
    --fs-18: 18px;
    --fs-20: 20px;

    /* Line heights */
    --lh-tight: 1.15;
    --lh-snug: 1.25;
    --lh-normal: 1.4;
    --lh-relaxed: 1.6;

    /* Letter spacing */
    --ls-tight: -0.01em;
    --ls-label: 0.12em; /* uppercase UI labels */
    --ls-chip: 0.08em;

    /* Spacing scale (4px base) */
    --s-1: 4px;
    --s-2: 8px;
    --s-3: 12px;
    --s-4: 16px;
    --s-5: 20px;
    --s-6: 24px;
    --s-7: 32px;
    --s-8: 40px;
    --s-9: 48px;
    --s-10: 56px;

    /* Radii */
    --r-sm: 10px;
    --r-md: 12px;
    --r-lg: 14px;
    --r-xl: 16px;
    --r-2xl: 20px;
    --r-pill: 999px;

    /* Elevation */
    --shadow-sm: 0 1px 0 rgba(255,255,255,0.04), 0 8px 24px rgba(0,0,0,0.35);
    --shadow-md: 0 1px 0 rgba(255,255,255,0.05), 0 16px 48px rgba(0,0,0,0.45);
    --shadow-lg: 0 1px 0 rgba(255,255,255,0.06), 0 24px 72px rgba(0,0,0,0.55);
    --shadow-inset: inset 0 1px 0 rgba(255,255,255,0.04), inset 0 0 0 1px rgba(0,0,0,0.55);

    /* Motion */
    --dur-1: 90ms;
    --dur-2: 140ms;
    --dur-3: 200ms;
    --dur-4: 320ms;
    --ease-out: cubic-bezier(.16, 1, .3, 1);
    --ease-inout: cubic-bezier(.65, 0, .35, 1);

    /* Legacy motion tokens used in PromptCanvas.css */
    --t-fast: var(--dur-2);
    --t-med: var(--dur-3);

    /* Control sizing ladder */
    --h-chip: 28px;
    --h-btn-sm: 32px;
    --h-btn-md: 34px;
    --h-btn-lg: 40px;
    --h-btn-cta: 44px;
    --h-btn-hero: 52px;

    --px-chip: 10px;
    --px-btn: 12px;
    --px-btn-lg: 14px;
    --px-btn-cta: 20px;

    /* Layout sizing (matches the screenshot + your newer block) */
    --gutter: 12px;
    --page-pad: 20px;

    --pc-rail-w: 72px;
    --pc-sessions-w: 320px;
    --pc-gutter: 280px; /* Versions column on XL */
    --stage-w: 380px;

    --sidebar-w: calc(var(--pc-rail-w) + var(--pc-sessions-w));
    --pc-editor-min: 520px;
    --pc-editor-max: min(980px, 100%);

    /* Outline overlay anchor (keep consistent with grid padding) */
    --pc-outline-top: var(--page-pad);

    /* Z-index scale */
    --z-popover: 1000;
    --z-modal: 1100;
    --z-tooltip: 1200;

    /* Glass/backdrop (matches OverlayKit defaults) */
    --glass-bg: rgba(16, 22, 34, 0.92);
    --glass-bg-2: rgba(16, 22, 34, 0.72);
    --glass-border: rgba(36, 49, 74, 0.9);
    --glass-border-2: rgba(49, 65, 99, 0.9);

    --backdrop: rgba(0, 0, 0, 0.58);
    --backdrop-soft: rgba(11, 15, 23, 0.35);
  }

  @media (prefers-reduced-motion: reduce) {
    :root {
      --dur-1: 0ms;
      --dur-2: 0ms;
      --dur-3: 0ms;
      --dur-4: 0ms;
    }
  }
}

/* ------------------------------------------
   ALIASES (bridge legacy token sets)
   ------------------------------------------ */
@layer ps.aliases {
  :root {
    /* OverlayKit token aliases */
    --po-dur-1: var(--dur-1);
    --po-dur-2: var(--dur-2);
    --po-dur-3: var(--dur-3);
    --po-dur-4: var(--dur-4);
    --po-ease-out: var(--ease-out);
    --po-ease-inout: var(--ease-inout);

    --po-r-sm: var(--r-md);
    --po-r-md: var(--r-lg);
    --po-r-lg: var(--r-xl);
    --po-r-xl: var(--r-2xl);
    --po-r-xxl: var(--r-2xl);

    --po-shadow-sm: var(--shadow-sm);
    --po-shadow-md: var(--shadow-md);
    --po-shadow-lg: var(--shadow-lg);

    --po-glass-bg: var(--glass-bg);
    --po-glass-bg-2: var(--glass-bg-2);
    --po-glass-border: var(--glass-border);
    --po-glass-border-2: var(--glass-border-2);

    --po-backdrop: var(--backdrop);
    --po-backdrop-soft: var(--backdrop-soft);

    --po-z-popover: var(--z-popover);
    --po-z-modal: var(--z-modal);
    --po-z-tooltip: var(--z-tooltip);

    /* Legacy spacing token sets â†’ --s-* (single source of truth) */
    --space-1: var(--s-1);
    --space-2: var(--s-2);
    --space-3: var(--s-3);
    --space-4: var(--s-4);
    --space-5: var(--s-5);
    --space-6: var(--s-6);
    --space-7: var(--s-7);
    --space-8: var(--s-8);
    --space-9: var(--s-9);
    --space-10: var(--s-10);

    --spacing-xxs: var(--s-1);
    --spacing-xs: var(--s-2);
    --spacing-sm: var(--s-3);
    --spacing-md: var(--s-4);
    --spacing-lg: var(--s-6);
    --spacing-xl: var(--s-7);
    --spacing-xxl: var(--s-8);

    /* Common radius semantic aliases used by page CSS */
    --r-card: var(--r-2xl);
    --r-input: var(--r-lg);
    --r-kbd: var(--r-md);
    --r-badge: var(--r-md);

    /* Old semantic naming used in Sessions rail */
    --text-primary: var(--text, #EBF0FF);
    --text-secondary: var(--text-muted, #A1AABC);
    --text-tertiary: var(--text-faint, #7D859B);

    --bg-sidebar: var(--surface-1, #101622);
    --bg-surface: var(--surface-2, #121A28);
    --bg-elevated: var(--surface-3, #152033);
    --border-subtle: var(--border, #24314A);

    /* Right-rail "rail-*" usage */
    --rail-muted: var(--text-muted, #A1AABC);
    --rail-faint: var(--text-faint, rgba(161,170,188,0.72));

    /* Geist aliases (so legacy rules don't look alien) */
    --geist-radius: var(--r-md);
    --geist-foreground: var(--text, #E7EBF3);
    --geist-background: var(--bg, #070A12);
    --geist-accents-6: var(--text-muted, #A1AABC);
  }
}

/* ------------------------------------------
   PRIMITIVES (motion/surfaces/overlays)
   ------------------------------------------ */
@layer ps.primitives {
  /* Motion helpers (keep existing class names) */
  @keyframes poFadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes poPopIn { from { opacity: 0; transform: translateY(10px) scale(0.985); } to { opacity: 1; transform: translateY(0) scale(1); } }
  @keyframes poShimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
  @keyframes poDotPulse {
    0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(104,134,255,0.0); opacity: 0.9; }
    50% { transform: scale(1.25); box-shadow: 0 0 0 6px rgba(104,134,255,0.14); opacity: 1; }
    100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(104,134,255,0.0); opacity: 0.9; }
  }

  .po-animate-fade-in { animation: poFadeIn var(--dur-3) var(--ease-out) both; }
  .po-animate-pop-in  { animation: poPopIn var(--dur-3) var(--ease-out) both; }

  /* Backdrops */
  .po-backdrop,
  .modal-backdrop,
  .po-diff {
    position: fixed;
    inset: 0;
    z-index: var(--z-modal);
    background: var(--backdrop);
    backdrop-filter: blur(10px) saturate(1.06);
    -webkit-backdrop-filter: blur(10px) saturate(1.06);
  }

  .po-backdrop--local,
  .inline-suggest-backdrop {
    position: absolute;
    inset: 0;
    z-index: var(--z-popover);
    background: var(--backdrop-soft);
    border-radius: var(--r-xl);
    backdrop-filter: blur(3px) saturate(1.04);
    -webkit-backdrop-filter: blur(3px) saturate(1.04);
  }

  /* Glass surfaces */
  .po-surface {
    color: var(--text, #E7EBF3);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--r-2xl);
    box-shadow: var(--shadow-md);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .po-surface--grad {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
  }

  .po-popover {
    z-index: var(--z-popover);
    border-radius: var(--r-xl);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
  }

  .po-modal {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: calc(var(--z-modal) + 1);
    width: min(820px, calc(100vw - 32px));
    max-height: calc(100vh - 32px);
    overflow: hidden;
  }

  .po-modal--xl {
    width: min(1180px, calc(100vw - 32px));
  }
}

/* ------------------------------------------
   COMPONENTS (buttons/inputs/chips/labels)
   ------------------------------------------ */
@layer ps.components {
  /* Headings */
  .po-title {
    font-family: var(--font-sans);
    font-size: var(--fs-16);
    font-weight: 600;
    letter-spacing: var(--ls-tight);
    color: var(--text-primary, #EBF0FF);
  }

  .po-subtitle {
    margin-top: 4px;
    font-size: var(--fs-12);
    font-weight: 500;
    color: var(--text-muted, #A1AABC);
  }

  /* Unified label style (fixes .prompt-output-label duplication) */
  .ui-label,
  .prompt-output-label {
    font-family: var(--font-sans);
    font-size: var(--fs-11);
    font-weight: 650;
    letter-spacing: var(--ls-label);
    text-transform: uppercase;
    color: var(--text-tertiary, #7D859B);
  }

  .prompt-output-subtitle {
    font-size: var(--fs-12);
    color: var(--text-muted, #A1AABC);
    line-height: var(--lh-normal);
  }

  /* Inputs */
  .po-input,
  .po-textarea,
  .prompt-input {
    font-family: var(--font-sans);
    color: var(--text, #E7EBF3);
    background: rgba(10,12,18,0.72);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: var(--r-md);
    outline: none;
    box-shadow: var(--shadow-inset);
  }

  .po-input {
    height: var(--h-btn-lg);
    padding: 0 var(--px-btn);
    font-size: var(--fs-13);
  }

  .po-textarea {
    min-height: 54px;
    padding: 10px var(--px-btn);
    font-size: var(--fs-13);
    resize: vertical;
  }

  .po-input:focus,
  .po-textarea:focus,
  .prompt-input:focus {
    border-color: rgba(104,134,255,0.55);
    box-shadow: 0 0 0 3px rgba(104,134,255,0.18);
  }

  /* Buttons */
  .po-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    height: var(--h-btn-lg);
    padding: 0 var(--px-btn-lg);
    border-radius: var(--r-md);
    border: 1px solid rgba(36,49,74,0.9);
    background: transparent;
    color: var(--text, #E7EBF3);
    font-family: var(--font-sans);
    font-size: var(--fs-13);
    font-weight: 650;
    cursor: pointer;
    transition: transform var(--dur-2) var(--ease-out),
                background var(--dur-2) var(--ease-out),
                border-color var(--dur-2) var(--ease-out),
                color var(--dur-2) var(--ease-out);
  }

  .po-btn:hover {
    transform: translateY(-1px);
    background: rgba(18,26,40,0.9);
    border-color: rgba(36,49,74,0.9);
  }

  .po-btn:disabled { opacity: 0.55; cursor: not-allowed; transform: none; }

  .po-btn--primary {
    border: 1px solid rgba(104,134,255,0.6);
    background: rgba(104,134,255,0.12);
  }

  .po-btn--danger {
    background: rgba(244,114,182,0.16);
    border-color: rgba(244,114,182,0.28);
  }

  /* Action cluster buttons (Copy/Diff/Export etc) */
  .po-action-btn,
  .prompt-card__action-button {
    height: var(--h-btn-md);
    padding: 0 var(--px-btn);
    border-radius: var(--r-md);
    font-size: var(--fs-12);
    font-weight: 650;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text-muted, #A1AABC);
    transition: background var(--dur-2) var(--ease-out),
                color var(--dur-2) var(--ease-out),
                border-color var(--dur-2) var(--ease-out),
                transform var(--dur-2) var(--ease-out);
  }

  .po-action-btn:hover,
  .prompt-card__action-button:hover {
    background: var(--surface-3, rgba(18,26,40,0.9));
    border-color: var(--border, rgba(36,49,74,0.9));
    color: var(--text, #E7EBF3);
    transform: translateY(-1px);
  }

  .prompt-card__action-primary {
    height: var(--h-btn-md);
    padding: 0 var(--px-btn);
    border-radius: var(--r-md);
    border: 1px solid rgba(255,255,255,0.14);
    background: linear-gradient(90deg, var(--accent, #6886FF), var(--accent-2, #8B66FF));
    color: #0B0F17;
    font-weight: 650;
  }

  /* Icon buttons */
  .po-action-icon,
  .icon-btn {
    width: var(--h-btn-md);
    height: var(--h-btn-md);
    border-radius: var(--r-md);
    border: 1px solid transparent;
    background: transparent;
    color: var(--text-muted, #A1AABC);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: background var(--dur-2) var(--ease-out),
                border-color var(--dur-2) var(--ease-out),
                color var(--dur-2) var(--ease-out),
                transform var(--dur-2) var(--ease-out);
  }

  .po-action-icon:hover,
  .icon-btn:hover {
    background: var(--surface-3, rgba(18,26,40,0.9));
    border-color: var(--border, rgba(36,49,74,0.9));
    color: var(--text, #E7EBF3);
    transform: translateY(-1px);
  }

  /* Right-rail preview button stays small */
  .prompt-right-rail__preview-button {
    height: var(--h-btn-sm);
    border-radius: var(--r-sm);
    font-size: var(--fs-12);
    font-weight: 600;
  }

  /* Stage CTA is intentionally larger */
  .po-stage__cta {
    height: var(--h-btn-cta);
    padding: 0 var(--px-btn-cta);
    border-radius: var(--r-lg);
    font-size: var(--fs-13);
    font-weight: 650;
    color: #0B0F17;
    background: linear-gradient(90deg, var(--accent, #6886FF), var(--accent-2, #8B66FF));
    border: 1px solid rgba(255,255,255,0.14);
    box-shadow: 0 10px 24px rgba(104,134,255,0.22);
    cursor: pointer;
    transition: transform var(--dur-2) var(--ease-out), filter var(--dur-2) var(--ease-out);
  }

  .po-stage__cta:hover:not(:disabled) {
    filter: brightness(1.04);
    transform: translateY(-1px);
  }

  .po-stage__cta:active:not(:disabled) {
    transform: translateY(0);
  }

  .po-stage__cta:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px rgba(104,134,255,0.22), 0 10px 24px rgba(104,134,255,0.22);
  }

  .po-stage__cta:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    box-shadow: none;
  }

  /* Chips */
  .prompt-chip {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 0 10px;
    height: var(--h-chip);
    border-radius: var(--r-pill);
    background: var(--surface-2, rgba(22,26,38,0.62));
    border: 1px solid var(--border, rgba(255,255,255,0.08));
  }

  .chip__dot {
    width: 6px;
    height: 6px;
    border-radius: 999px;
    background: rgba(104,134,255,0.85);
    box-shadow: 0 0 0 2px rgba(104,134,255,0.14);
  }

  .prompt-chip__label {
    font-size: var(--fs-10);
    font-weight: 650;
    letter-spacing: var(--ls-chip);
    text-transform: uppercase;
    color: var(--text-tertiary, #7D859B);
    white-space: nowrap;
  }

  /* The pill select trigger inside chips */
  .po-chip-select {
    height: var(--h-chip);
    border-radius: var(--r-pill);
    padding: 0 var(--px-chip);
    font-size: var(--fs-12);
    font-weight: 600;
  }

  /* Badges + keycaps */
  .po-kbd,
  .kbd {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 22px;
    padding: 0 8px;
    border-radius: var(--r-kbd, 12px);
    background: var(--surface-1, rgba(0,0,0,0.30));
    border: 1px solid var(--border, rgba(255,255,255,0.10));
    font-size: var(--fs-11);
    font-weight: 650;
    color: var(--text-muted, #AAB2C8);
    white-space: nowrap;
  }

  .po-badge {
    display: inline-flex;
    align-items: center;
    height: 20px;
    padding: 0 8px;
    border-radius: 999px;
    font-size: var(--fs-11);
    border: 1px solid rgba(255,255,255,0.10);
    color: var(--text-secondary, #AAB2C8);
    background: rgba(22,26,38,0.62);
  }

  .po-badge--best {
    background: rgba(104,134,255,0.14);
    border-color: rgba(104,134,255,0.35);
    color: var(--text, #E7EBF3);
  }

  /* Status dot pulse for "generating" */
  .status-pill[data-status='generating'] .status-pill__dot {
    animation: poDotPulse 1.2s var(--ease-inout) infinite;
    transform-origin: center;
  }
}

/* ------------------------------------------
   UTILITIES (optional)
   ------------------------------------------ */
@layer ps.utilities {
  .ui-body {
    font-family: var(--font-sans);
    font-size: var(--fs-13);
    line-height: var(--lh-normal);
    color: var(--text, #E7EBF3);
  }

  .ui-meta {
    font-size: var(--fs-12);
    color: var(--text-muted, #A1AABC);
  }

  .ui-mono {
    font-family: var(--font-mono);
  }
}
