description = "Add or update tests using Vitest and Playwright."
prompt = """
Add or update tests for the change.

Testing stack:
- Unit/integration: Vitest (config/test/vitest.config.js)
- Integration: Vitest (config/test/vitest.integration.config.js)
- E2E: Playwright (config/test/playwright.config.js)

## Integration tests

Read docs/architecture/typescript/TEST_GUIDE.md Part 3 before writing integration tests.

Cardinal rule: write tests from contracts, not implementations.

Contract files to read:
- server/src/config/services.config.ts (service registrations)
- server/src/config/services.initialize.ts (init order, health checks)
- server/src/app.ts (middleware, route mounting)
- server/src/routes/*.routes.ts (route paths, schemas)
- server/src/schemas/*.ts (Zod contracts)

Do NOT read service class implementations, handler bodies, or prompt templates when writing assertions.

Workflow:
1. Read contract files above.
2. Write assertions based on what the contracts promise.
3. Run the test â€” expect failures.
4. Report failures with root cause analysis.
5. STOP. Ask whether to fix source code or adjust the test spec.

When fixing failures: fix source code by default, not the test. Never weaken assertions.

## Unit tests

Show which test files you will touch before implementing.
Use existing test patterns in the codebase as reference.
"""
